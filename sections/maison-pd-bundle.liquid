{%- assign product_has_bogo_tag = false -%}
{%- if product.tags contains 'buy-1-get-free' -%}
  {%- assign product_has_bogo_tag = true -%}
{%- endif -%}

{%- comment -%} Get rating from metafield {%- endcomment -%}
{%- assign rating_metafield_key = section.settings.metafield_rating_key | default: 'custom.rating' -%}
{%- assign rating_count_metafield_key = section.settings.metafield_rating_count_key | default: 'custom.rating_count' -%}
{%- assign rating_parts = rating_metafield_key | split: '.' -%}
{%- assign count_parts = rating_count_metafield_key | split: '.' -%}
{%- if rating_parts.size == 2 -%}
  {%- assign product_rating = product.metafields[rating_parts[0]][rating_parts[1]] | default: 0 | times: 1 -%}
{%- else -%}
  {%- assign product_rating = 0 -%}
{%- endif -%}
{%- if count_parts.size == 2 -%}
  {%- assign product_rating_count = product.metafields[count_parts[0]][count_parts[1]] | default: '0' -%}
{%- else -%}
  {%- assign product_rating_count = '0' -%}
{%- endif -%}

{% schema %}
{
  "name": "Product Bundle",
  "settings": [
    {
      "type": "text",
      "id": "gallery_badge_text",
      "label": "Gallery Badge Text",
      "default": "BUY 1, GET 1 FREE",
      "info": "Badge shown in product gallery"
    },
    {
      "type": "text",
      "id": "gallery_badge_subtext",
      "label": "Gallery Badge Subtext",
      "default": "Add at least 2 items to your cart. Discount applied automatically.",
      "info": "Smaller text below badge"
    },
    {
      "type": "text",
      "id": "price_badge_text",
      "label": "Price Badge Text",
      "default": "BUY 1, GET 1 FREE",
      "info": "Badge shown next to price"
    },
    {
      "type": "text",
      "id": "features_text",
      "label": "Features Text",
      "default": "Camel Toe Proof Technology | Seamless | Wide Absorbent Gusset | High Rise"
    },
    {
      "type": "text",
      "id": "protection_title",
      "label": "Protection Block Title",
      "default": "Your order is protected by"
    },
    {
      "type": "text",
      "id": "protection_heading",
      "label": "Protection Block Heading",
      "default": "90 Day Fit Exchange & Money Back Guarantee"
    },
    {
      "type": "richtext",
      "id": "protection_description",
      "label": "Protection Block Description",
      "default": "<p>If you need to exchange for a different size, or don't like our thong for any reason, we'll send you a new size for free or a full refund.</p>"
    },
    {
      "type": "image_picker",
      "id": "protection_icon",
      "label": "Protection Block Icon"
    },
    {
      "type": "text",
      "id": "loved_by_heading",
      "label": "Loved By Heading",
      "default": "Loved by By 5,800+ Happy Customers"
    },
    {
      "type": "text",
      "id": "metafield_rating_key",
      "label": "Rating Metafield Key",
      "default": "custom.rating",
      "info": "Product metafield namespace.key for rating (e.g., custom.rating)"
    },
    {
      "type": "text",
      "id": "metafield_rating_count_key",
      "label": "Rating Count Metafield Key",
      "default": "custom.rating_count",
      "info": "Product metafield namespace.key for rating count"
    },
    {
      "type": "color",
      "id": "section_bg_color",
      "label": "Section Background Color",
      "default": "#FCF5F4"
    },
    {
      "type": "color",
      "id": "badge_bg_color",
      "label": "Badge Background Color",
      "default": "#F7E6E2"
    },
    {
      "type": "color",
      "id": "badge_border_color",
      "label": "Badge Border Color",
      "default": "#F0D3CB"
    },
    {
      "type": "color",
      "id": "price_badge_bg_color",
      "label": "Price Badge Background Color",
      "default": "#12B76A"
    },
    {
      "type": "color",
      "id": "price_badge_text_color",
      "label": "Price Badge Text Color",
      "default": "#F6FEF9"
    },
    {
      "type": "color",
      "id": "protection_bg_color",
      "label": "Protection Block Background Color",
      "default": "#F7E6E2"
    },
    {
      "type": "color",
      "id": "protection_border_color",
      "label": "Protection Block Border Color",
      "default": "#F0D3CB"
    },
    {
      "type": "header",
      "content": "Delivery Information"
    },
    {
      "type": "checkbox",
      "id": "show_delivery_info",
      "label": "Show Delivery Information",
      "default": true
    },
    {
      "type": "text",
      "id": "delivery_flag",
      "label": "Delivery Flag Emoji",
      "default": "ðŸ‡ºðŸ‡¸"
    },
    {
      "type": "text",
      "id": "delivery_prefix",
      "label": "Delivery Text Prefix",
      "default": "Delivered on "
    },
    {
      "type": "text",
      "id": "delivery_date",
      "label": "Delivery Date",
      "default": "Friday, 21 November"
    },
    {
      "type": "text",
      "id": "delivery_suffix",
      "label": "Delivery Text Suffix",
      "default": " with Express Shipping"
    },
    {
      "type": "header",
      "content": "Payment Methods"
    },
    {
      "type": "checkbox",
      "id": "show_payment_methods",
      "label": "Show Payment Methods",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_visa",
      "label": "Show Visa",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_unionpay",
      "label": "Show UnionPay",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_shoppay",
      "label": "Show Shop Pay",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_mastercard",
      "label": "Show Mastercard",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_maestro",
      "label": "Show Maestro",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_googlepay",
      "label": "Show Google Pay",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_discover",
      "label": "Show Discover",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_dinersclub",
      "label": "Show Diners Club",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_applepay",
      "label": "Show Apple Pay",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_amex",
      "label": "Show American Express",
      "default": true
    },
    {
      "type": "header",
      "content": "Shipping Information"
    },
    {
      "type": "checkbox",
      "id": "show_shipping_info",
      "label": "Show Shipping Information",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_free_shipping",
      "label": "Show Free Shipping",
      "default": true
    },
    {
      "type": "text",
      "id": "free_shipping_text",
      "label": "Free Shipping Text",
      "default": "FREE Worldwide Shipping"
    },
    {
      "type": "checkbox",
      "id": "show_money_back",
      "label": "Show Money-Back Guarantee",
      "default": true
    },
    {
      "type": "text",
      "id": "money_back_text",
      "label": "Money-Back Guarantee Text",
      "default": "14-Day Money-Back Guarantee"
    }
  ],
  "blocks": [
    {
      "type": "@app"
    },
    {
      "type": "buy_buttons",
      "name": "t:sections.main-product.blocks.buy_buttons.name",
      "limit": 1,
      "settings": [
        {
          "type": "header",
          "content": "General"
        },
        {
          "type": "paragraph",
          "content": "IMPORTANT: Variant selectors in Quantity breaks do NOT work with dynamic checkout buttons."
        },
        {
          "type": "checkbox",
          "id": "show_dynamic_checkout",
          "default": false,
          "label": "t:sections.main-product.blocks.buy_buttons.settings.show_dynamic_checkout.label",
          "info": "t:sections.main-product.blocks.buy_buttons.settings.show_dynamic_checkout.info"
        },
        {
          "type": "checkbox",
          "id": "skip_cart",
          "label": "Skip cart",
          "default": false,
          "info": "Your customers will be sent directly to checkout after click the Add to Cart button."
        },
        {
          "type": "header",
          "content": "Button"
        },
        {
          "type": "checkbox",
          "id": "uppercase_text",
          "label": "Uppercase button labels",
          "default": true
        },
        {
          "type": "checkbox",
          "id": "display_price",
          "label": "Display price inside the button",
          "default": false
        },
        {
          "type": "checkbox",
          "id": "enable_custom_color",
          "label": "Enable custom button color",
          "default": false
        },
        {
          "type": "color",
          "id": "custom_color",
          "default": "#dd1d1d",
          "label": "Button custom color",
          "info": "Applied when Enable custom button color is checked."
        },
        {
          "type": "header",
          "content": "Block margin"
        },
        {
          "type": "range",
          "id": "margin_top",
          "min": 0,
          "max": 45,
          "step": 3,
          "unit": "px",
          "label": "Top margin",
          "default": 24
        },
        {
          "type": "range",
          "id": "margin_bottom",
          "min": 0,
          "max": 45,
          "step": 3,
          "unit": "px",
          "label": "Bottom margin",
          "default": 24
        }
      ]
    }, 
    {
      "type": "review",
      "name": "Review",
      "settings": [
        {
          "type": "text",
          "id": "reviewer_name",
          "label": "Reviewer Name",
          "default": "Rachel D."
        },
        {
          "type": "richtext",
          "id": "review_text",
          "label": "Review Text",
          "default": "<p>These are hands down the best underwear to wear under any leggings. I no longer feel exposed! Super comfy and don't show any seam lines. Off to buy some more!</p>"
        },
        {
          "type": "range",
          "id": "rating",
          "min": 1,
          "max": 5,
          "step": 0.1,
          "label": "Rating",
          "default": 4.6
        },
        {
          "type": "text",
          "id": "rating_text",
          "label": "Rating Text",
          "default": "Rated Excellent 4.6/5 stars"
        },
        {
          "type": "image_picker",
          "id": "reviewer_avatar",
          "label": "Reviewer Avatar"
        },
        {
          "type": "text",
          "id": "source",
          "label": "Review Source",
          "default": "Trustpilot",
          "info": "e.g., Trustpilot, Google Reviews"
        }
      ]
    },
    {
      "type": "faq",
      "name": "FAQ",
      "settings": [
        {
          "type": "text",
          "id": "question",
          "label": "Question",
          "default": "Product Details"
        },
        {
          "type": "richtext",
          "id": "answer",
          "label": "Answer"
        }
      ]
    },
    {
      "type": "customer_image",
      "name": "Customer Image",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Product Bundle"
    }
  ]
}
{% endschema %}

<section class="maison_commerce_pd_bundle" x-data="maison_commerce_pd_bundle_init()">
  <div class="maison_commerce_pd_bundle__container">
    <!-- Product Gallery -->
    <div class="maison_commerce_pd_bundle__gallery">
      <div class="maison_commerce_pd_bundle__main-image">
        {% if product.featured_image %}
          <div class="maison_commerce_pd_bundle__main-image-wrapper">
            <img
              src="{{ product.featured_image | image_url: width: 1200 }}"
              alt="{{ product.title | escape }}"
              loading="eager"
              class="maison_commerce_pd_bundle__main-img maison_commerce_pd_bundle__main-img--active"
              id="maison-pd-main-image"
            >
            <div class="maison_commerce_pd_bundle__image-loader" id="maison-pd-image-loader">
              <div class="maison_commerce_pd_bundle__loader-spinner"></div>
            </div>
          </div>
        {% endif %}

        {% if product_has_bogo_tag %}
          <div class="maison_commerce_pd_bundle__gallery-badge">
            <p class="maison_commerce_pd_bundle__gallery-badge-text">
              {{ section.settings.gallery_badge_text }}
            </p>
            <p class="maison_commerce_pd_bundle__gallery-badge-subtext">
              {{ section.settings.gallery_badge_subtext }}
            </p>
          </div>
        {% endif %}
      </div>

      {% comment %} Preload all product images {% endcomment %}
      {% if product.images.size > 1 %}
        <div style="display: none;">
          {% for image in product.images %}
            {% unless forloop.first %}
              <link rel="preload" as="image" href="{{ image | image_url: width: 1200 }}">
            {% endunless %}
          {% endfor %}
        </div>
      {% endif %}

      {% if product.images.size > 1 %}
        <div class="maison-pd-gallery-slider-wrapper">
          <div class="swiper-button-prev maison_commerce_pd_bundle__thumb-prev maison-pd-gallery-buttons">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
              <path d="M12.5 15L7.5 10L12.5 5" stroke="#151515" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <div class="swiper maison_commerce_pd_bundle__thumbnails">
            <div class="swiper-wrapper maison-pd-gallery-slider">
              {% for image in product.images %}
                <div class="swiper-slide maison_commerce_pd_bundle__thumbnail-slide">
                  <button
                    type="button"
                    class="maison_commerce_pd_bundle__thumbnail {% if forloop.first %}maison_commerce_pd_bundle__thumbnail--active{% endif %}"
                    data-image-index="{{ forloop.index0 }}"
                    data-image-url="{{ image | image_url: width: 1200 }}"
                    @click="changeMainImage('{{ image | image_url: width: 1200 }}', {{ forloop.index0 }})"
                  >
                    <img
                      src="{{ image | image_url: width: 160 }}"
                      alt="{{ product.title | escape }} - Image {{ forloop.index }}"
                      loading="lazy"
                    >
                  </button>
                </div>
              {% endfor %}
            </div>
          </div>
          <div class="swiper-button-next maison_commerce_pd_bundle__thumb-next maison-pd-gallery-buttons">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
              <path d="M7.5 15L12.5 10L7.5 5" stroke="#151515" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
        </div>
      {% endif %}
    </div>

    <!-- Product Info -->
    <div class="maison_commerce_pd_bundle__info">
      <div class="maison_commerce_pd_bundle__info-general">
        <div class="maison_commerce_pd_bundle__info-main">
          {% if product_rating > 0 %}
            <div class="maison_commerce_pd_bundle__rating">
              <div class="maison_commerce_pd_bundle__stars">
                {% assign full_stars = product_rating | floor %}
                {% assign has_half_star = product_rating | modulo: 1 | times: 1 %}
                {% assign next_star_index = full_stars | plus: 1 %}
                {% for i in (1..5) %}
                  {% if i <= full_stars %}
                    <svg
                      class="maison_commerce_pd_bundle__star"
                      width="16"
                      height="16"
                      viewBox="0 0 16 16"
                      fill="none"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path d="M8 0L9.798 5.527L15.608 5.527L10.905 8.946L12.703 14.473L8 11.054L3.297 14.473L5.095 8.946L0.392 5.527L6.202 5.527L8 0Z" fill="#FEC84B"/>
                    </svg>
                  {% else %}
                    {% assign is_half_star = false %}
                    {% if i == next_star_index %}
                      {% if has_half_star >= 0.5 %}
                        {% assign is_half_star = true %}
                      {% endif %}
                    {% endif %}
                    {% if is_half_star %}
                      <svg
                        class="maison_commerce_pd_bundle__star"
                        width="16"
                        height="16"
                        viewBox="0 0 16 16"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <path d="M8 0L9.798 5.527L15.608 5.527L10.905 8.946L12.703 14.473L8 11.054L3.297 14.473L5.095 8.946L0.392 5.527L6.202 5.527L8 0Z" fill="#FEC84B" opacity="0.5"/>
                      </svg>
                    {% else %}
                      <svg
                        class="maison_commerce_pd_bundle__star"
                        width="16"
                        height="16"
                        viewBox="0 0 16 16"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <path d="M8 0L9.798 5.527L15.608 5.527L10.905 8.946L12.703 14.473L8 11.054L3.297 14.473L5.095 8.946L0.392 5.527L6.202 5.527L8 0Z" fill="#FEC84B" opacity="0.2"/>
                      </svg>
                    {% endif %}
                  {% endif %}
                {% endfor %}
              </div>
              <p class="maison_commerce_pd_bundle__rating-text">
                {{ product_rating }}/5 Stars By {{ product_rating_count }} Happy Customers
              </p>
            </div>
          {% endif %}

          <h1 class="maison_commerce_pd_bundle__title">
            {{ product.title }}
          </h1>

          {% if section.settings.features_text != blank %}
            <p class="maison_commerce_pd_bundle__features">
              {{ section.settings.features_text }}
            </p>
          {% endif %}
        </div>

        <div class="maison_commerce_pd_bundle__price">
          {% if product.compare_at_price > product.price %}
            <span class="maison_commerce_pd_bundle__compare-price">
              {{ product.compare_at_price | money }}
            </span>
          {% endif %}
          <span class="maison_commerce_pd_bundle__current-price">
            {{ product.price | money }}
          </span>
          {% if product_has_bogo_tag %}
            <span class="maison_commerce_pd_bundle__price-badge">
              {{ section.settings.price_badge_text }}
            </span>
          {% endif %}
        </div>
      </div>

      <!-- Bundle Section Placeholder (for app integration) -->
      <div class="maison_commerce_pd_bundle__bundle-placeholder">
        <p class="maison_commerce_pd_bundle__bundle-note">SELECT YOUR COLORS AND SIZES:</p>
        <div id="maison-bundle-app-container">
          {%- for block in section.blocks -%}
            {%- case block.type -%}
              {%- when '@app' -%}
                {% render block %}
            {%- endcase -%}
          {%- endfor -%}
        </div>
        
        <!-- Delivery Information -->
        {% if section.settings.show_delivery_info %}
          <div class="maison_commerce_pd_bundle__delivery-info">
            <p class="maison_commerce_pd_bundle__delivery-text">
              {% if section.settings.delivery_flag != blank %}{{ section.settings.delivery_flag }} {% endif %}
              <span>{{ section.settings.delivery_prefix }}</span>
              <span class="maison_commerce_pd_bundle__delivery-date">{{ section.settings.delivery_date }}</span>
              <span>{{ section.settings.delivery_suffix }}</span>
            </p>
          </div>
        {% endif %}

        {%- for block in section.blocks -%}
          {%- case block.type -%}
            {%- when 'buy_buttons' -%}
              {%- render 'buy-buttons', block: block, product: product, product_form_id: product_form_id, section_id: section.id, show_pickup_availability: true, main_product: true -%}
          {%- endcase -%}
        {%- endfor -%}
        
        <!-- Payment Methods -->
        {% if section.settings.show_payment_methods %}
          <div class="maison_commerce_pd_bundle__payment-methods">
            {% if section.settings.show_visa %}
              <div class="maison_commerce_pd_bundle__payment-method">
                <svg xmlns="http://www.w3.org/2000/svg" width="23" height="16" viewBox="0 0 23 16" fill="none">
                  <g clip-path="url(#clip0_4001_3156)">
                    <rect width="23" height="16" rx="2.5" fill="white"/>
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M7.02515 10.8388H5.6318L4.58695 6.79488C4.53736 6.60886 4.43206 6.4444 4.27717 6.36689C3.89062 6.17211 3.46466 6.0171 2.99998 5.93891V5.78322H5.24457C5.55435 5.78322 5.78669 6.0171 5.82542 6.28871L6.36754 9.20572L7.76022 5.78322H9.11485L7.02515 10.8388ZM9.88931 10.8388H8.5734L9.65697 5.78322H10.9729L9.88931 10.8388ZM12.6753 7.18377C12.7141 6.91148 12.9464 6.75579 13.2175 6.75579C13.6434 6.7167 14.1074 6.79488 14.4947 6.98899L14.727 5.9005C14.3398 5.74481 13.9138 5.66663 13.5273 5.66663C12.2501 5.66663 11.3207 6.3669 11.3207 7.33879C11.3207 8.07815 11.979 8.46636 12.4437 8.70024C12.9464 8.93344 13.14 9.08913 13.1013 9.32233C13.1013 9.67212 12.7141 9.82782 12.3275 9.82782C11.8628 9.82782 11.3982 9.71122 10.9729 9.51643L10.7405 10.6056C11.2052 10.7997 11.7079 10.8779 12.1726 10.8779C13.6047 10.9163 14.4947 10.2167 14.4947 9.16664C14.4947 7.84427 12.6753 7.76677 12.6753 7.18377ZM19.1 10.8388L18.0552 5.78322H16.9329C16.7005 5.78322 16.4682 5.93891 16.3907 6.17211L14.4559 10.8388H15.8106L16.0809 10.1001H17.7454L17.9003 10.8388H19.1ZM17.1265 7.14468L17.513 9.05004H16.4294L17.1265 7.14468Z" fill="#172B85"/>
                  </g>
                  <rect x="0.5" y="0.5" width="22" height="15" rx="3.5" stroke="black" stroke-opacity="0.08"/>
                  <defs>
                    <clipPath id="clip0_4001_3156">
                      <rect width="23" height="16" rx="4" fill="white"/>
                    </clipPath>
                  </defs>
                </svg>
              </div>
            {% endif %}
            {% if section.settings.show_unionpay %}
              <div class="maison_commerce_pd_bundle__payment-method">
                <svg width="23" height="16" viewBox="0 0 23 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <rect x="0.5" y="0.5" width="22" height="15" rx="3.5" fill="white" stroke="rgba(0,0,0,0.08)"/>
                </svg>
              </div>
            {% endif %}
            {% if section.settings.show_shoppay %}
              <div class="maison_commerce_pd_bundle__payment-method">
                <svg width="23" height="16" viewBox="0 0 23 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <rect x="0.5" y="0.5" width="22" height="15" rx="3.5" fill="#5a31f4" stroke="rgba(0,0,0,0.08)"/>
                </svg>
              </div>
            {% endif %}
            {% if section.settings.show_mastercard %}
              <div class="maison_commerce_pd_bundle__payment-method">
                <svg width="23" height="16" viewBox="0 0 23 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <rect x="0.5" y="0.5" width="22" height="15" rx="3.5" fill="white" stroke="rgba(0,0,0,0.08)"/>
                </svg>
              </div>
            {% endif %}
            {% if section.settings.show_maestro %}
              <div class="maison_commerce_pd_bundle__payment-method">
                <svg width="23" height="16" viewBox="0 0 23 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <rect x="0.5" y="0.5" width="22" height="15" rx="3.5" fill="white" stroke="rgba(0,0,0,0.08)"/>
                </svg>
              </div>
            {% endif %}
            {% if section.settings.show_googlepay %}
              <div class="maison_commerce_pd_bundle__payment-method">
                <svg width="23" height="16" viewBox="0 0 23 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <rect x="0.5" y="0.5" width="22" height="15" rx="3.5" fill="white" stroke="rgba(0,0,0,0.08)"/>
                </svg>
              </div>
            {% endif %}
            {% if section.settings.show_discover %}
              <div class="maison_commerce_pd_bundle__payment-method">
                <svg width="23" height="16" viewBox="0 0 23 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <rect x="0.5" y="0.5" width="22" height="15" rx="3.5" fill="white" stroke="rgba(0,0,0,0.08)"/>
                </svg>
              </div>
            {% endif %}
            {% if section.settings.show_dinersclub %}
              <div class="maison_commerce_pd_bundle__payment-method">
                <svg width="23" height="16" viewBox="0 0 23 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <rect x="0.5" y="0.5" width="22" height="15" rx="3.5" fill="white" stroke="rgba(0,0,0,0.08)"/>
                </svg>
              </div>
            {% endif %}
            {% if section.settings.show_applepay %}
              <div class="maison_commerce_pd_bundle__payment-method">
                <svg width="23" height="16" viewBox="0 0 23 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <rect x="0.5" y="0.5" width="22" height="15" rx="3.5" fill="white" stroke="rgba(0,0,0,0.08)"/>
                </svg>
              </div>
            {% endif %}
            {% if section.settings.show_amex %}
              <div class="maison_commerce_pd_bundle__payment-method">
                <svg width="23" height="16" viewBox="0 0 23 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <rect x="0.5" y="0.5" width="22" height="15" rx="3.5" fill="#1f72cd" stroke="rgba(0,0,0,0.08)"/>
                </svg>
              </div>
            {% endif %}
          </div>
        {% endif %}
        
        <!-- Shipping Info -->
        {% if section.settings.show_shipping_info %}
          <div class="maison_commerce_pd_bundle__shipping-info">
            {% if section.settings.show_free_shipping %}
              <div class="maison_commerce_pd_bundle__shipping-item">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M2 6L8 2L14 6V12C14 12.5304 13.7893 13.0391 13.4142 13.4142C13.0391 13.7893 12.5304 14 12 14H4C3.46957 14 2.96086 13.7893 2.58579 13.4142C2.21071 13.0391 2 12.5304 2 12V6Z" stroke="#151515" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M6 14V8H10V14" stroke="#151515" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <p class="maison_commerce_pd_bundle__shipping-text">{{ section.settings.free_shipping_text }}</p>
              </div>
            {% endif %}
            {% if section.settings.show_money_back %}
              <div class="maison_commerce_pd_bundle__shipping-item">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M1 4H15C15.2652 4 15.5196 4.10536 15.7071 4.29289C15.8946 4.48043 16 4.73478 16 5V13C16 13.2652 15.8946 13.5196 15.7071 13.7071C15.5196 13.8946 15.2652 14 15 14H1C0.734784 14 0.48043 13.8946 0.292893 13.7071C0.105357 13.5196 0 13.2652 0 13V5C0 4.73478 0.105357 4.48043 0.292893 4.29289C0.48043 4.10536 0.734784 4 1 4Z" stroke="#151515" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M4 4V2C4 1.73478 4.10536 1.48043 4.29289 1.29289C4.48043 1.10536 4.73478 1 5 1H11C11.2652 1 11.5196 1.10536 11.7071 1.29289C11.8946 1.48043 12 1.73478 12 2V4" stroke="#151515" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M4 8H12" stroke="#151515" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <p class="maison_commerce_pd_bundle__shipping-text">{{ section.settings.money_back_text }}</p>
              </div>
            {% endif %}
          </div>
        {% endif %}
      </div>

      <!-- Protection Block -->
      {% if section.settings.protection_title != blank %}
        <div class="maison_commerce_pd_bundle__protection">
          {% if section.settings.protection_icon %}
            <img
              src="{{ section.settings.protection_icon | image_url: width: 56 }}"
              alt=""
              class="maison_commerce_pd_bundle__protection-icon"
            >
          {% endif %}
          <div class="maison_commerce_pd_bundle__protection-content">
            <p class="maison_commerce_pd_bundle__protection-title">
              {{ section.settings.protection_title }}
            </p>
            <p class="maison_commerce_pd_bundle__protection-heading">
              {{ section.settings.protection_heading }}
            </p>
            <div class="maison_commerce_pd_bundle__protection-description">
              {{ section.settings.protection_description }}
            </div>
          </div>
        </div>
      {% endif %}

      <!-- Reviews Slider -->
      {% assign review_blocks = section.blocks | where: 'type', 'review' %}
      {% if review_blocks.size > 0 %}
        <div class="maison-pd-reviews-slider-wrapper">
          <div class="swiper maison_commerce_pd_bundle__reviews">
            <div class="swiper-wrapper maison-pd-review-slider">
              {% for block in review_blocks %}
                <div class="swiper-slide maison_commerce_pd_bundle__review-slide" {{ block.shopify_attributes }}>
                  <div class="maison_commerce_pd_bundle__review">
                    {% if block.settings.reviewer_avatar %}
                      <img
                        src="{{ block.settings.reviewer_avatar | image_url: width: 96 }}"
                        alt="{{ block.settings.reviewer_name | escape }}"
                        class="maison_commerce_pd_bundle__review-avatar"
                      >
                    {% endif %}
                    <div class="maison_commerce_pd_bundle__review-content">
                      <div class="maison_commerce_pd_bundle__review-header">
                        <div class="maison_commerce_pd_bundle__review-stars">
                          {% assign review_rating = block.settings.rating | times: 1.0 %}
                          {% assign full_stars = review_rating | floor %}
                          {% assign decimal_part = review_rating | minus: full_stars %}

                          {% for i in (1..5) %}
                            {% if i <= full_stars %}
                              <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none">
                                <rect width="12" height="12" fill="#00B67A"/>
                                <path d="M6 8.10063L7.7381 7.63522L8.46429 10L6 8.10063ZM10 5.04402H6.94048L6 2L5.05952 5.04402H2L4.47619 6.93082L3.53571 9.97484L6.01191 8.08805L7.53571 6.93082L10 5.04402Z" fill="white"/>
                              </svg>
                            {% elsif i > full_stars and decimal_part >= 0.5 and decimal_part <= 0.9 %}
                              <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none">
                                <rect width="12" height="12" fill="#00B67A"/>
                                <rect x="6" width="6" height="12" fill="#EAECF0"/>
                                <path d="M6 8.10063L7.7381 7.63522L8.46429 10L6 8.10063ZM10 5.04402H6.94048L6 2L5.05952 5.04402H2L4.47619 6.93082L3.53571 9.97484L6.01191 8.08805L7.53571 6.93082L10 5.04402Z" fill="white"/>
                              </svg>
                            {% else %}
                              <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none">
                                <rect width="12" height="12" fill="#00B67A"/>
                                <path d="M0 0H12V12H0V0Z" fill="#EAECF0"/>
                                <path d="M6 8.10063L7.7381 7.63522L8.46429 10L6 8.10063ZM10 5.04403H6.94048L6 2L5.05952 5.04403H2L4.47619 6.93082L3.53571 9.97484L6.01191 8.08805L7.53571 6.93082L10 5.04403Z" fill="white"/>
                              </svg>
                            {% endif %}
                          {% endfor %}
                        </div>
                        <p class="maison_commerce_pd_bundle__review-rating-text">
                          {{ block.settings.rating_text }}
                        </p>
                      </div>
                      <div class="maison_commerce_pd_bundle__review-text">
                        {{ block.settings.review_text }}
                      </div>
                      <div class="maison_commerce_pd_bundle__review-footer">
                        <p class="maison_commerce_pd_bundle__review-name">
                          {{ block.settings.reviewer_name }}
                        </p>
                        {% if block.settings.source != blank %}
                          <div class="maison_commerce_pd_bundle__review-source">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 14 14" fill="none">
                              <path d="M7 10.6761L10.0417 9.86164L11.3125 14L7 10.6761ZM14 5.32704H8.64583L7 0L5.35417 5.32704H0L4.33334 8.62893L2.6875 13.956L7.02083 10.6541L9.6875 8.62893L14 5.32704Z" fill="#00B67A"/>
                            </svg>
                            <span>{{ block.settings.source }}</span>
                          </div>
                        {% endif %}
                      </div>
                    </div>
                  </div>
                </div>
              {% endfor %}
            </div>
          </div>
          <div class="swiper-pagination maison_commerce_pd_bundle__reviews-pagination"></div>
        </div>
      {% endif %}

      <!-- FAQs Accordion -->
      {% assign faq_blocks = section.blocks | where: 'type', 'faq' %}
      {% if faq_blocks.size > 0 %}
        <div class="maison_commerce_pd_bundle__faqs">
          {% for block in faq_blocks %}
            <div class="maison_commerce_pd_bundle__faq" {{ block.shopify_attributes }}>
              <button
                type="button"
                class="maison_commerce_pd_bundle__faq-button"
                @click="toggleFaq({{ forloop.index0 }})"
                :aria-expanded="openFaq === {{ forloop.index0 }}"
              >
                <span class="maison_commerce_pd_bundle__faq-question">
                  {{ block.settings.question }}
                </span>
                <span
                  class="maison_commerce_pd_bundle__faq-icon"
                  :class="{ 'maison_commerce_pd_bundle__faq-icon--open': openFaq === {{ forloop.index0 }} }"
                >
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                    <path d="M5 12H19M12 5V19" stroke="#151515" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </span>
              </button>
              <div
                class="maison_commerce_pd_bundle__faq-answer"
                x-show="openFaq === {{ forloop.index0 }}"
                x-transition
              >
                {{ block.settings.answer }}
              </div>
            </div>
          {% endfor %}
        </div>
      {% endif %}

      <!-- Customer Images Slider -->
      {% assign image_blocks = section.blocks | where: 'type', 'customer_image' %}
      {% if image_blocks.size > 0 %}
        <div class="maison_commerce_pd_bundle__customer-images">
          <div class="maison_commerce_pd_bundle__customer-images-header">
            <h2 class="maison_commerce_pd_bundle__customer-images-heading">
              {{ section.settings.loved_by_heading }}
            </h2>
            <div class="maison_commerce_pd_bundle__customer-images-nav">
              <button class="maison_commerce_pd_bundle__customer-images-prev maison-pd-image-slider-btns" type="button">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M15 18L9 12L15 6" stroke="#151515" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
              <button class="maison_commerce_pd_bundle__customer-images-next maison-pd-image-slider-btns" type="button">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M9 18L15 12L9 6" stroke="#151515" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
            </div>
          </div>
          <div class="swiper maison_commerce_pd_bundle__customer-images-swiper">
            <div class="swiper-wrapper maison-pd-image-slider">
              {% for block in image_blocks %}
                {% if block.settings.image %}
                  <div
                    class="swiper-slide maison_commerce_pd_bundle__customer-image-slide"
                    {{ block.shopify_attributes }}
                  >
                    <img
                      src="{{ block.settings.image | image_url: width: 400 }}"
                      alt="Customer image {{ forloop.index }}"
                      loading="lazy"
                      class="maison_commerce_pd_bundle__customer-image"
                    >
                  </div>
                {% endif %}
              {% endfor %}
            </div>
          </div>
        </div>
      {% endif %}
    </div>
  </div>
</section>

<style>
  .maison_commerce_pd_bundle {
    background-color: {{ section.settings.section_bg_color }};
    border-top: 1px solid {{ section.settings.badge_border_color }};
    border-bottom: 1px solid {{ section.settings.badge_border_color }};
    padding: 40px 80px;
  }

  @media (max-width: 1050px) {
    .maison_commerce_pd_bundle {
      padding: 20px;
    }
  }

  .maison-pd-gallery-slider{
    display: flex;
  }

  .maison_commerce_pd_bundle__container {
    max-width: 1280px;
    margin: 0 auto;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 80px;
    align-items: flex-start;
  }

  .maison-pd-image-slider{
    display: flex;
    width: fit-content;
  }

  .maison-pd-gallery-slider-wrapper{
    display: flex;
    gap: 8px;
    align-items: center;
  }

  @media (max-width: 1050px) {
    .maison_commerce_pd_bundle__container {
      flex-direction: column;
      gap: 20px;
    }
  }

  /* Gallery */
  .maison_commerce_pd_bundle__gallery {
    width: 100%;
    max-width: 600px;
    flex-shrink: 0;
    position: sticky;
    top: 0;
  }

  .maison-pd-reviews-slider-wrapper{
    display: grid;
    flex-direction: column;
    gap: 16px;
  }

  .maison_commerce_pd_bundle__info-main{
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .maison_commerce_pd_bundle__info-general{
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  .maison-pd-review-slider{
    display: flex;
    width: fit-content;
  }

  .maison-pd-review-slider .maison_commerce_pd_bundle__review{
    width: 100%;
  }

  .maison-pd-image-slider-btns{
    transition: all 0.3s ease;
  }

  .maison-pd-image-slider-btns:hover{
    background: rgba(255,255,255, 0.2);
  }

  @media (max-width: 1050px) {
    .maison_commerce_pd_bundle__gallery {
      width: 100%;
      position: static;
    }
  }

  .maison_commerce_pd_bundle__main-image {
    width: 100%;
    height: 600px;
    border-radius: 24px;
    overflow: hidden;
    position: relative;
    margin-bottom: 20px;
  }

  @media (max-width: 1050px) {
    .maison_commerce_pd_bundle__main-image {
      height: auto;
      aspect-ratio: 1;
    }
  }

  .maison_commerce_pd_bundle__main-image-wrapper {
    width: 100%;
    height: 100%;
    position: relative;
    background-color: #f5f5f5;
  }

  .maison_commerce_pd_bundle__main-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    transition: opacity 0.3s ease;
  }

  .maison_commerce_pd_bundle__image-loader {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(245, 245, 245, 0.9);
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
    z-index: 10;
    border-radius: 24px;
  }

  .maison_commerce_pd_bundle__image-loader--active {
    opacity: 1;
    visibility: visible;
  }

  .maison_commerce_pd_bundle__loader-spinner {
    width: 40px;
    height: 40px;
    border: 3px solid rgba(21, 21, 21, 0.1);
    border-top-color: #151515;
    border-radius: 50%;
    animation: maison-pd-spin 0.8s linear infinite;
  }

  @keyframes maison-pd-spin {
    to {
      transform: rotate(360deg);
    }
  }

  .maison_commerce_pd_bundle__gallery-badge {
    position: absolute;
    top: 12px;
    left: 12px;
    background-color: {{ section.settings.badge_bg_color }};
    border: 1px solid {{ section.settings.badge_border_color }};
    border-radius: 16px;
    padding: 8px;
    max-width: 180px;
  }

  .maison_commerce_pd_bundle__gallery-badge-text {
    font-weight: 600;
    font-size: 12px;
    line-height: 1.5;
    color: #151515;
    margin: 0 0 4px 0;
  }

  .maison_commerce_pd_bundle__gallery-badge-subtext {
    font-size: 10px;
    line-height: 1.5;
    color: rgba(21, 21, 21, 0.75);
    margin: 0;
  }

  /* Thumbnails */
  .maison_commerce_pd_bundle__thumbnails {
    position: relative;
    display: flex;
    gap: 8px;
    align-items: center;
    overflow: hidden;
    flex: 1;
  }

  .maison_commerce_pd_bundle__thumbnail-slide {
    width: auto;
  }

  .maison_commerce_pd_bundle__thumbnail {
    width: 80px;
    height: 80px;
    border-radius: 16px;
    border: 2px solid transparent;
    padding: 0;
    background: none;
    cursor: pointer;
    overflow: hidden;
    transition: border-color 0.3s ease;
  }

  .maison_commerce_pd_bundle__thumbnail--active {
    border-color: #151515;
  }

  .maison_commerce_pd_bundle__thumbnail img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  .maison_commerce_pd_bundle__thumb-prev,
  .maison_commerce_pd_bundle__thumb-next {
    width: 40px;
    height: 40px;
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.08);
    border-radius: 999px;
    margin-top: 0;
    top: 50%;
    transform: translateY(-50%);
  }

  .maison_commerce_pd_bundle__thumb-prev {
    left: -20px;
  }

  .maison_commerce_pd_bundle__thumb-next {
    right: -20px;
  }

  /* Product Info */
  .maison_commerce_pd_bundle__info {
    width: 100%;
    max-width: 600px;
    display: flex;
    flex-direction: column;
    gap: 40px;
  }

  @media (max-width: 1050px) {
    .maison_commerce_pd_bundle__info {
      gap: 20px;
    }
  }

  .maison_commerce_pd_bundle__rating {
    display: flex;
    gap: 8px;
    align-items: center;
    height: 20px;
  }

  .maison_commerce_pd_bundle__stars {
    display: flex;
    gap: 0;
  }

  .maison_commerce_pd_bundle__star {
    width: 16px;
    height: 16px;
  }

  .maison_commerce_pd_bundle__rating-text {
    font-weight: 500;
    font-size: 12px;
    line-height: 1.5;
    color: #151515;
    margin: 0;
  }

  .maison_commerce_pd_bundle__title {
    font-weight: 700;
    font-size: 32px;
    line-height: 1.3;
    color: #151515;
    margin: 0;
  }

  @media (max-width: 1050px) {
    .maison_commerce_pd_bundle__title {
      font-size: 20px;
      line-height: 1.4;
    }
  }

  .maison_commerce_pd_bundle__features {
    font-size: 14px;
    line-height: 1.5;
    color: rgba(21, 21, 21, 0.75);
    margin: 0;
  }

  @media (max-width: 1050px) {
    .maison_commerce_pd_bundle__features {
      font-size: 12px;
    }
  }

  .maison_commerce_pd_bundle__price {
    display: flex;
    gap: 12px;
    align-items: center;
    flex-wrap: wrap;
  }

  .maison_commerce_pd_bundle__compare-price {
    font-weight: 500;
    font-size: 18px;
    line-height: 1.5;
    color: #151515;
    text-decoration: line-through;
    opacity: 0.5;
  }

  @media (max-width: 1050px) {
    .maison_commerce_pd_bundle__compare-price {
      font-size: 14px;
    }
  }

  .maison_commerce_pd_bundle__current-price {
    font-weight: 700;
    font-size: 24px;
    line-height: 1.4;
    color: #151515;
  }

  @media (max-width: 1050px) {
    .maison_commerce_pd_bundle__current-price {
      font-size: 20px;
    }
  }

  .maison_commerce_pd_bundle__price-badge {
    background-color: {{ section.settings.price_badge_bg_color }};
    color: {{ section.settings.price_badge_text_color }};
    font-weight: 500;
    font-size: 12px;
    line-height: 1.5;
    padding: 4px 12px;
    border-radius: 8px;
    height: 24px;
    display: inline-flex;
    align-items: center;
  }

  /* Bundle Placeholder */
  .maison_commerce_pd_bundle__bundle-placeholder {
    background: white;
    border: 1px solid {{ section.settings.badge_border_color }};
    border-radius: 16px;
    padding: 20px;
  }

  .maison_commerce_pd_bundle__bundle-note {
    font-weight: 600;
    font-size: 12px;
    line-height: 1.5;
    color: #151515;
    opacity: 0.5;
    margin: 0 0 12px 0;
  }

  /* Delivery Information */
  .maison_commerce_pd_bundle__delivery-info {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
    margin-bottom: 16px;
  }

  .kaching-bundles .kaching-bundles__bar-wrapper{
    padding: 0!important;
  }

  .kaching-bundles .kaching-bundles__bar--selected .kaching-bundles__bar-main{
    display: none;
  }

  .kaching-bundles .kaching-bundles__bundle-products{
    border: none!important;
  }

  .kaching-bundles__bundle-products__divider{
    display: none!important;
  }

  .kaching-bundles .kaching-bundles__bundle-products--vertical .kaching-bundles__bundle-products__product{
    border-top: 1px dashed rgba(0, 0, 0, 0.08);
  }

  .kaching-bundles .kaching-bundles__bar-wrapper{
    border-bottom: 1px dashed rgba(0, 0, 0, 0.08);
  }

  .maison_commerce_pd_bundle__delivery-text {
    font-family: 'Poppins', sans-serif;
    font-weight: 500;
    font-size: 14px;
    line-height: 1.5;
    color: #151515;
    text-align: center;
    margin: 0;
  }

  .maison_commerce_pd_bundle__delivery-date {
    text-decoration: underline;
    text-underline-position: from-font;
    font-weight: 700;
  }

  @media (max-width: 1050px) {
    .maison_commerce_pd_bundle__delivery-info {
      padding: 0 24px;
    }

    .maison_commerce_pd_bundle__delivery-text {
      font-size: 10px;
    }
  }

  /* Payment Methods */
  .maison_commerce_pd_bundle__payment-methods {
    display: flex;
    gap: 12px;
    align-items: center;
    justify-content: center;
    margin-top: 16px;
    flex-wrap: wrap;
  }

  @media (max-width: 1050px) {
    .maison_commerce_pd_bundle__payment-methods {
      gap: 8px;
    }
  }

  .maison_commerce_pd_bundle__payment-method {
    width: 23px;
    height: 16px;
    border: 1px solid rgba(0, 0, 0, 0.08);
    border-radius: 4px;
    overflow: hidden;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .maison_commerce_pd_bundle__payment-method svg {
    width: 100%;
    height: 100%;
  }

  /* Shipping Info */
  .maison_commerce_pd_bundle__shipping-info {
    background: rgba(0, 0, 0, 0.02);
    border-radius: 8px;
    padding: 8px 16px;
    margin-top: 16px;
    display: flex;
    gap: 20px;
    align-items: center;
    justify-content: center;
    flex-wrap: wrap;
  }

  @media (max-width: 1050px) {
    .maison_commerce_pd_bundle__shipping-info {
      flex-direction: column;
      gap: 8px;
      align-items: flex-start;
    }
  }

  .maison_commerce_pd_bundle__shipping-item {
    display: flex;
    gap: 8px;
    align-items: center;
  }

  .maison_commerce_pd_bundle__shipping-item svg {
    width: 16px;
    height: 16px;
    flex-shrink: 0;
  }

  .maison_commerce_pd_bundle__shipping-text {
    font-family: 'Poppins', sans-serif;
    font-weight: 500;
    font-size: 12px;
    line-height: 1.5;
    color: #151515;
    margin: 0;
    white-space: nowrap;
  }

  @media (max-width: 1050px) {
    .maison_commerce_pd_bundle__shipping-text {
      font-size: 10px;
    }
  }

  /* Protection Block */
  .maison_commerce_pd_bundle__protection {
    background-color: {{ section.settings.protection_bg_color }};
    border: 1px solid {{ section.settings.protection_border_color }};
    border-radius: 12px;
    padding: 16px;
    display: flex;
    gap: 16px;
    align-items: center;
  }

  .maison_commerce_pd_bundle__protection-icon {
    width: 56px;
    height: 56px;
    flex-shrink: 0;
  }

  @media (max-width: 1050px) {
    .maison_commerce_pd_bundle__protection-icon {
      width: 32px;
      height: 32px;
    }
  }

  .maison_commerce_pd_bundle__protection-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .maison_commerce_pd_bundle__protection-title {
    font-weight: 600;
    font-size: 12px;
    line-height: 1.5;
    color: #C4858E;
    margin: 0;
  }

  @media (max-width: 1050px) {
    .maison_commerce_pd_bundle__protection-title {
      font-size: 10px;
    }
  }

  .maison_commerce_pd_bundle__protection-heading {
    font-weight: 600;
    font-size: 14px;
    line-height: 1.5;
    color: #151515;
    margin: 0;
  }

  @media (max-width: 1050px) {
    .maison_commerce_pd_bundle__protection-heading {
      font-size: 12px;
    }
  }

  .maison_commerce_pd_bundle__protection-description {
    font-size: 12px;
    line-height: 1.5;
    color: rgba(21, 21, 21, 0.75);
    margin: 0;
  }

  .maison_commerce_pd_bundle__protection-description p{
    margin: 0;
  }

  @media (max-width: 1050px) {
    .maison_commerce_pd_bundle__protection-description {
      font-size: 10px;
    }
  }

  /* Reviews */
  .maison_commerce_pd_bundle__reviews {
    position: relative;
    width: 100%;
    overflow: hidden;
  }

  .maison_commerce_pd_bundle__review {
    background: white;
    border: 1px solid {{ section.settings.badge_border_color }};
    border-radius: 12px;
    padding: 16px;
    display: flex;
    gap: 16px;
  }

  .maison_commerce_pd_bundle__review-avatar {
    width: 48px;
    height: 48px;
    border-radius: 999px;
    flex-shrink: 0;
    object-fit: cover;
  }

  @media (max-width: 1050px) {
    .maison_commerce_pd_bundle__review-avatar {
      width: 32px;
      height: 32px;
    }
  }

  .maison_commerce_pd_bundle__review-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .maison_commerce_pd_bundle__review-header {
    display: flex;
    gap: 8px;
    align-items: center;
  }

  .maison_commerce_pd_bundle__review-stars {
    display: flex;
    gap: 2px;
  }

  .maison_commerce_pd_bundle__review-rating-text {
    font-weight: 600;
    font-size: 14px;
    line-height: 1.5;
    color: #151515;
    margin: 0;
  }

  @media (max-width: 1050px) {
    .maison_commerce_pd_bundle__review-rating-text {
      font-size: 12px;
    }
  }

  .maison_commerce_pd_bundle__review-text {
    font-size: 12px;
    line-height: 1.5;
    color: rgba(21, 21, 21, 0.75);
  }

  .maison_commerce_pd_bundle__review-text p{
     margin: 0;
  }

  @media (max-width: 1050px) {
    .maison_commerce_pd_bundle__review-text {
      font-size: 10px;
    }
  }

  .maison_commerce_pd_bundle__review-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: 4px;
  }

  .maison_commerce_pd_bundle__review-name {
    font-style: italic;
    font-size: 12px;
    line-height: 1.5;
    color: #151515;
    opacity: 0.5;
    margin: 0;
    border-top: 1px solid #D0D5DD;
  }

  @media (max-width: 1050px) {
    .maison_commerce_pd_bundle__review-name {
      font-size: 10px;
    }
  }

  .maison_commerce_pd_bundle__review-source {
    display: flex;
    gap: 4px;
    align-items: center;
    font-weight: 500;
    font-size: 12px;
    color: #151515;
    line-height: 14px;
  }

  @media (max-width: 1050px) {
    .maison_commerce_pd_bundle__review-source {
      font-size: 10px;
    }
  }

  .maison_commerce_pd_bundle__reviews-pagination {
    position: static;
    margin-top: 16px;
    display: flex;
    justify-content: center;
    gap: 4px;
  }

  .maison_commerce_pd_bundle__reviews-pagination .swiper-pagination-bullet {
    width: 8px;
    height: 8px;
    background: #151515;
    opacity: 0.2;
    border-radius: 999px;
  }

  .maison_commerce_pd_bundle__reviews-pagination .swiper-pagination-bullet-active {
    opacity: 1;
  }

  /* FAQs */
  .maison_commerce_pd_bundle__faqs {
    display: flex;
    flex-direction: column;
  }

  .maison_commerce_pd_bundle__faq {
    border-top: 1px solid rgba(0, 0, 0, 0.08);
  }

  .maison_commerce_pd_bundle__faq:last-child {
    border-bottom: 1px solid rgba(0, 0, 0, 0.08);
  }

  .maison_commerce_pd_bundle__faq-button {
    width: 100%;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px 0;
    background: none;
    border: none;
    cursor: pointer;
    gap: 12px;
  }

  @media (max-width: 1050px) {
    .maison_commerce_pd_bundle__faq-button {
      padding: 12px 0;
    }
  }

  .maison_commerce_pd_bundle__faq-question {
    font-weight: 600;
    font-size: 14px;
    line-height: 1.5;
    color: #151515;
    text-align: left;
    flex: 1;
  }

  @media (max-width: 1050px) {
    .maison_commerce_pd_bundle__faq-question {
      font-size: 12px;
    }
  }

  .maison_commerce_pd_bundle__faq-icon {
    font-size: 24px;
    font-weight: bold;
    color: #151515;
    transition: transform 0.3s ease;
    flex-shrink: 0;
  }

  .maison_commerce_pd_bundle__faq-icon--open {
    transform: rotate(45deg);
  }

  .maison_commerce_pd_bundle__faq-answer {
    padding-bottom: 16px;
    font-size: 14px;
    line-height: 1.5;
    color: rgba(21, 21, 21, 0.75);
  }

  @media (max-width: 1050px) {
    .maison_commerce_pd_bundle__faq-answer {
      font-size: 12px;
      padding-bottom: 12px;
    }
  }

  /* Customer Images */
  .maison_commerce_pd_bundle__customer-images {
    display: grid;
    flex-direction: column;
    gap: 16px;
  }

  .maison_commerce_pd_bundle__customer-images-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .maison_commerce_pd_bundle__customer-images-heading {
    font-weight: 700;
    font-size: 20px;
    line-height: 1.4;
    color: #151515;
    margin: 0;
  }

  @media (max-width: 1050px) {
    .maison_commerce_pd_bundle__customer-images-heading {
      font-size: 18px;
    }
  }

  .maison_commerce_pd_bundle__customer-images-nav {
    display: flex;
    gap: 8px;
  }

  .maison_commerce_pd_bundle__customer-images-prev,
  .maison_commerce_pd_bundle__customer-images-next {
    width: 32px;
    height: 32px;
    background: white;
    border: 1px solid {{ section.settings.badge_border_color }};
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    padding: 4px;
  }

  @media (max-width: 1050px) {
    .maison_commerce_pd_bundle__customer-images-prev,
    .maison_commerce_pd_bundle__customer-images-next {
      width: 28px;
      height: 28px;
    }
  }

  .maison_commerce_pd_bundle__customer-images-swiper {
    overflow: hidden;
  }

  .maison_commerce_pd_bundle__customer-image {
    width: 100%;
    height: 280px;
    object-fit: cover;
    border-radius: 12px;
  }

  @media (max-width: 1050px) {
    .maison_commerce_pd_bundle__customer-image {
      height: 160px;
    }
  }

  .maison-pd-gallery-buttons{
    position: relative!important;
    top: auto!important;
    left: auto!important;
    right: auto!important;
    bottom: auto!important;
    transform: none!important;
    display: none;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
  }
  
  .maison-pd-gallery-buttons.maison-pd-gallery-buttons--visible {
    display: flex;
  }

  .maison-pd-gallery-buttons:hover{
    background: rgba(255,255,255, 0.2);
  }

  @media(max-width: 950px){
    .maison_commerce_pd_bundle__container{
      display: flex;
    }

    .maison_commerce_pd_bundle__gallery, .maison_commerce_pd_bundle__info{
      max-width: none;
    }
  }

  .kaching-bundles .kaching-bundles__bar--selected .kaching-bundles__bar-container{
    box-shadow: none!important;
  }
</style>

<script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

<script>
  function maison_commerce_pd_bundle_init() {
    return {
      openFaq: null,

      toggleFaq(index) {
        this.openFaq = this.openFaq === index ? null : index;
      },

      changeMainImage(imageUrl, index) {
        const mainImg = document.getElementById('maison-pd-main-image');
        const loader = document.getElementById('maison-pd-image-loader');

        if (!mainImg) return;

        // Show loader
        if (loader) {
          loader.classList.add('maison_commerce_pd_bundle__image-loader--active');
        }

        // Preload the new image
        const newImg = new Image();
        newImg.onload = function () {
          // Image loaded, update src
          mainImg.src = imageUrl;

          // Hide loader after a brief moment for smooth transition
          setTimeout(() => {
            if (loader) {
              loader.classList.remove('maison_commerce_pd_bundle__image-loader--active');
            }
          }, 100);
        };

        newImg.onerror = function () {
          // If image fails to load, still hide loader
          if (loader) {
            loader.classList.remove('maison_commerce_pd_bundle__image-loader--active');
          }
        };

        // Start loading
        newImg.src = imageUrl;

        // Update active thumbnail
        document.querySelectorAll('.maison_commerce_pd_bundle__thumbnail').forEach((thumb, i) => {
          if (i === index) {
            thumb.classList.add('maison_commerce_pd_bundle__thumbnail--active');
          } else {
            thumb.classList.remove('maison_commerce_pd_bundle__thumbnail--active');
          }
        });
      },
    };
  }

  document.addEventListener('DOMContentLoaded', function () {
    // Preload all product images in the background
    const thumbnailButtons = document.querySelectorAll('.maison_commerce_pd_bundle__thumbnail[data-image-url]');
    thumbnailButtons.forEach((button) => {
      const imageUrl = button.getAttribute('data-image-url');
      if (imageUrl) {
        const img = new Image();
        img.src = imageUrl;
      }
    });

    // Thumbnail Swiper
    const thumbnailSwiper = document.querySelector('.maison_commerce_pd_bundle__thumbnails');
    const thumbPrevBtn = document.querySelector('.maison_commerce_pd_bundle__thumb-prev');
    const thumbNextBtn = document.querySelector('.maison_commerce_pd_bundle__thumb-next');
    
    if (thumbnailSwiper) {
      const swiperInstance = new Swiper('.maison_commerce_pd_bundle__thumbnails', {
        slidesPerView: 'auto',
        spaceBetween: 8,
        navigation: {
          nextEl: '.maison_commerce_pd_bundle__thumb-next',
          prevEl: '.maison_commerce_pd_bundle__thumb-prev',
        },
        on: {
          init: function() {
            checkThumbnailNavigation(this);
          },
          resize: function() {
            checkThumbnailNavigation(this);
          },
          slideChange: function() {
            checkThumbnailNavigation(this);
          }
        }
      });
      
      function checkThumbnailNavigation(swiper) {
        // Check if all slides fit in the container
        const containerWidth = swiper.width;
        let totalSlidesWidth = 0;
        
        swiper.slides.forEach((slide, index) => {
          totalSlidesWidth += slide.offsetWidth;
          if (index < swiper.slides.length - 1) {
            totalSlidesWidth += 8; // spaceBetween
          }
        });
        
        const needsNavigation = totalSlidesWidth > containerWidth;
        
        if (thumbPrevBtn) {
          if (needsNavigation) {
            thumbPrevBtn.classList.add('maison-pd-gallery-buttons--visible');
          } else {
            thumbPrevBtn.classList.remove('maison-pd-gallery-buttons--visible');
          }
        }
        if (thumbNextBtn) {
          if (needsNavigation) {
            thumbNextBtn.classList.add('maison-pd-gallery-buttons--visible');
          } else {
            thumbNextBtn.classList.remove('maison-pd-gallery-buttons--visible');
          }
        }
      }
    }

    // Reviews Swiper
    const reviewsSwiper = document.querySelector('.maison_commerce_pd_bundle__reviews');
    if (reviewsSwiper) {
      new Swiper('.maison_commerce_pd_bundle__reviews', {
        slidesPerView: 1,
        spaceBetween: 12,
        pagination: {
          el: '.maison_commerce_pd_bundle__reviews-pagination',
          clickable: true,
        },
        breakpoints: {
          950: {
            slidesPerView: 1.3,
          },
        }
      });
    }

    // Customer Images Swiper
    const customerImagesSwiper = document.querySelector('.maison_commerce_pd_bundle__customer-images-swiper');
    if (customerImagesSwiper) {
      const swiper = new Swiper('.maison_commerce_pd_bundle__customer-images-swiper', {
        slidesPerView: 3,
        spaceBetween: 12
      });

      // Custom navigation
      const prevBtn = document.querySelector('.maison_commerce_pd_bundle__customer-images-prev');
      const nextBtn = document.querySelector('.maison_commerce_pd_bundle__customer-images-next');

      if (prevBtn) {
        prevBtn.addEventListener('click', () => swiper.slidePrev());
      }
      if (nextBtn) {
        nextBtn.addEventListener('click', () => swiper.slideNext());
      }
    }
  });
</script>

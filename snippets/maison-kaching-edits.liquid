<!-- MAISON KACHING EDITS -->
<script>
  async function waitForKaching() {
    return new Promise(async (resolve) => {
      let el;
      while (!el) {
        el = document.querySelector('.kaching-bundles__bar-container');
        await new Promise((x) => setTimeout(x, 10));
      }

      resolve();
    });
  }

  function addNumbers() {
    const bars = document.querySelectorAll('.kaching-bundles__bar-container');
    for (let barindex = 0; barindex < bars.length; barindex++) {
      const bar = bars[barindex];
      const containers = Array.from(bar.querySelectorAll('img')).map((img) => img.parentElement);

      for (let containerindex = 0; containerindex < containers.length; containerindex++) {
        const container = containers[containerindex];
        container.style.position = 'relative';

        const id = `bar-${barindex}-container-${containerindex}`;
        if (document.getElementById(id)) continue;

        const div = document.createElement('div');
        div.id = id;
        div.innerText = (containerindex + 1).toString();
        div.style.position = 'absolute';
        div.style.top = '0';
        div.style.left = '0';
        div.style.backgroundColor = 'white';
        div.style.color = 'black';
        div.style.padding = '4px 8px';
        div.style.borderRadius = '0 0 8px 0';
        div.style.fontSize = '12px';

        container.appendChild(div);

        console.log('[MAISON KACHING EDITS] added number', id);
      }
    }
  }

  function addSwatchFunctionality(COLOR_MAP) {
    const bars = document.querySelectorAll('.kaching-bundles__bar-container');
    for (let barindex = 0; barindex < bars.length; barindex++) {
      const bar = bars[barindex];

      const selects = bar.querySelectorAll('.kaching-bundles__bar-variant-select[data-name="Color"]');

      for (let selectindex = 0; selectindex < selects.length; selectindex++) {
        const select = selects[selectindex];
        select.style.setProperty('padding-left', '40px', 'important');
        const container = select.parentElement;
        container.style.position = 'relative';

        const id = `bar-${barindex}-select-${selectindex}`;
        if (document.getElementById(id)) continue;

        const div = document.createElement('div');
        div.id = id;
        div.style.display = 'flex';
        div.style.position = 'absolute';
        div.style.top = '6px';
        div.style.left = '4px';
        div.style.width = '20px';
        div.style.height = '20px';
        div.style.backgroundColor = COLOR_MAP[select.value.toUpperCase()];
        div.style.borderRadius = '100%';
        div.style.zIndex = '1000';

        container.appendChild(div);

        console.log('[MAISON KACHING EDITS] added swatch functionality', `swatch-${select.id}`);

        if (!select.getAttribute('maison-event-added')) {
          select.setAttribute('maison-event-added', 'true');
          select.addEventListener('change', (e) => {
            const div = document.getElementById(id);
            div.style.backgroundColor = COLOR_MAP[e.target.value.toUpperCase()];
          });
        }
      }
    }
  }

  setInterval(async () => {
    const COLOR_MAP = {
      SAND: '#E6D2C0',
      BLACK: '#000000',
      MOSS: '#78866B',
      COFFEE: '#6F4E37',
    };

    await waitForKaching();
    addNumbers();
    addSwatchFunctionality(COLOR_MAP);
  }, 10);
</script>
